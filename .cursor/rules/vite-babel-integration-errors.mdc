---
description: 
globs: 
alwaysApply: false
---
# Vite + Babel é›†æˆå¸¸è§é”™è¯¯è®°å½•

## ğŸš¨ é”™è¯¯è®°å½•ï¼šJSX é…ç½®å†²çª

### é”™è¯¯ç—‡çŠ¶
```
Failed to parse source for import analysis because the content contains invalid JS syntax. 
If you use tsconfig.json, make sure to not set jsx to preserve.
```

### é”™è¯¯åŸå› 
- âŒ **é”™è¯¯åšæ³•**ï¼šåœ¨ vite.config.ts ä¸­è®¾ç½® `jsx: 'preserve'` ä½†æ²¡æœ‰æ­£ç¡®é…ç½® babel å¤„ç†
- âŒ **é”™è¯¯ç†è§£**ï¼šä»¥ä¸ºè®¾ç½® `jsx: 'preserve'` å°±èƒ½è®© babel è‡ªåŠ¨æ¥ç®¡
- âŒ **é…ç½®å†²çª**ï¼švite å’Œ babel çš„ JSX å¤„ç†äº§ç”Ÿå†²çª

### æ­£ç¡®è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1: å®Œå…¨ä½¿ç”¨ Babel å¤„ç†ï¼ˆæ¨èï¼‰
```typescript
// vite.config.ts
export default defineConfig({
  plugins: [
    // æ·»åŠ  babel æ’ä»¶
    babel({
      babelHelpers: 'bundled',
      extensions: ['.js', '.jsx', '.ts', '.tsx'],
    }),
  ],
  esbuild: false, // å®Œå…¨ç¦ç”¨ esbuild
});
```

#### æ–¹æ¡ˆ 2: æ··åˆé…ç½®ï¼ˆéœ€è¦ç²¾ç¡®æ§åˆ¶ï¼‰
```typescript
// vite.config.ts  
export default defineConfig({
  esbuild: {
    jsx: 'transform',
    jsxFactory: 'hyperscript',
    jsxFragment: 'Fragment',
  },
  // ä¸ä½¿ç”¨ babel å¤„ç† JSX
});
```

### âœ… å½“å‰é¡¹ç›®çš„æ­£ç¡®é…ç½®

å¯¹äº `@vanilla-dom` é¡¹ç›®ï¼š
1. **å¿…é¡»ä½¿ç”¨ babel-plugin** è¿›è¡Œ JSX å¤„ç†
2. **preset-widget** æä¾›ç»„ä»¶æ³¨å†Œç­‰æ‰©å±•åŠŸèƒ½
3. **ä¸èƒ½ä¾èµ– esbuild** å¤„ç† JSX

```javascript
// .babelrc.js
module.exports = {
  presets: [
    '@vanilla-dom/preset-widget', // æ ¸å¿ƒï¼šç»„ä»¶å¤„ç†
    '@babel/preset-typescript',   // TS æ”¯æŒ
  ],
};
```

```typescript
// vite.config.ts
export default defineConfig({
  // ä¸è®¾ç½®ä»»ä½• JSX ç›¸å…³çš„ esbuild é…ç½®
  // è®© babel å®Œå…¨æ¥ç®¡
});
```

## ğŸ”§ ä¿®å¤æ­¥éª¤

1. ç§»é™¤ vite ä¸­çš„ `jsx: 'preserve'` é…ç½®
2. ç¡®ä¿æœ‰æ­£ç¡®çš„ `.babelrc.js` é…ç½®
3. å®‰è£…å¿…è¦çš„ babel æ’ä»¶ï¼š`pnpm install --save-dev @vitejs/plugin-babel`
4. é‡å¯å¼€å‘æœåŠ¡å™¨

## ğŸ“ æ•™è®­æ€»ç»“

- **ä¸è¦æ··åˆä½¿ç”¨** vite esbuild å’Œ babel å¤„ç† JSX
- **æ˜ç¡®é€‰æ‹©ä¸€ç§æ–¹æ¡ˆ**ï¼šè¦ä¹ˆå…¨ babelï¼Œè¦ä¹ˆå…¨ esbuild
- **@vanilla-dom é¡¹ç›®å¿…é¡»ç”¨ babel**ï¼Œå› ä¸ºéœ€è¦ç»„ä»¶æ³¨å†Œç­‰ç‰¹æ®Šå¤„ç†
- **jsx: 'preserve'** åªåœ¨æœ‰å…¶ä»–å·¥å…·æ¥ç®¡æ—¶ä½¿ç”¨ï¼Œä¸æ˜¯ä¸‡èƒ½é…ç½®
