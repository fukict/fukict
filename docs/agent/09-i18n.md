# 国际化 (i18n)

官方国际化库，支持多语言、复数、日期格式化。

## 安装

```bash
pnpm add @fukict/i18n
```

## 基础配置

```tsx
import { createI18n } from '@fukict/i18n';

const i18n = createI18n({
  defaultLocale: 'en',
  locale: 'en',
  messages: {
    en: {
      hello: 'Hello',
      welcome: 'Welcome, {name}!',
    },
    zh: {
      hello: '你好',
      welcome: '欢迎，{name}！',
    },
  },
});
```

## 使用翻译

```tsx
class App extends Fukict {
  render() {
    return (
      <div>
        <h1>{i18n.t('hello')}</h1>
        <p>{i18n.t('welcome', { name: 'Alice' })}</p>
      </div>
    );
  }
}
```

## 嵌套翻译

```tsx
const i18n = createI18n({
  defaultLocale: 'en',
  messages: {
    en: {
      user: {
        profile: 'User Profile',
        settings: 'Settings',
      },
    },
  },
});

// 使用点号访问
i18n.t('user.profile'); // 'User Profile'
```

## 复数形式

```tsx
const i18n = createI18n({
  defaultLocale: 'en',
  messages: {
    en: {
      apple: {
        one: '{count} apple',
        other: '{count} apples',
      },
    },
    zh: {
      apple: {
        other: '{count} 个苹果',
      },
    },
  },
});

i18n.t('apple', { count: 1 }); // '1 apple'
i18n.t('apple', { count: 5 }); // '5 apples'
```

## 切换语言

```tsx
class LanguageSwitcher extends Fukict {
  async changeLanguage(locale: string) {
    await i18n.changeLocale(locale);
    this.update();
  }

  render() {
    return (
      <div>
        <button on:click={() => this.changeLanguage('en')}>English</button>
        <button on:click={() => this.changeLanguage('zh')}>中文</button>
      </div>
    );
  }
}
```

## 组件订阅语言变化

```tsx
class TranslatedText extends Fukict {
  private unsubscribe?: () => void;

  mounted() {
    this.unsubscribe = i18n.subscribe(() => {
      this.update();
    });
  }

  beforeUnmount() {
    this.unsubscribe?.();
  }

  render() {
    return <h1>{i18n.t('hello')}</h1>;
  }
}
```

## 懒加载语言包

```tsx
const i18n = createI18n({
  defaultLocale: 'en',
  fallbackLocale: 'en',
  messages: {
    en: { hello: 'Hello' },
  },
  loadMessages: async (locale: string) => {
    const res = await fetch(`/locales/${locale}.json`);
    return res.json();
  },
});

// 切换到未加载的语言会自动触发加载
await i18n.changeLocale('zh');
```

## 数字格式化

```tsx
i18n.n(1234.56); // '1,234.56' (en)
i18n.n(1234.56, { style: 'currency', currency: 'USD' }); // '$1,234.56'
```

## 日期格式化

```tsx
i18n.d(new Date()); // '1/9/2026'
i18n.d(Date.now(), { dateStyle: 'long' }); // 'January 9, 2026'
```

## 相对时间

```tsx
i18n.rt(-1, 'day'); // 'yesterday'
i18n.rt(2, 'day'); // 'in 2 days'
```

## 缺失翻译处理

```tsx
const i18n = createI18n({
  defaultLocale: 'en',
  fallbackLocale: 'en',
  messages: { en: {} },
  missingHandler: 'fallback', // 返回 key 或 fallback 语言
  // 或使用自定义函数
  missingHandler: (key, locale) => {
    console.warn(`Missing: ${key} in ${locale}`);
    return key;
  },
});
```

## 全局配置

```tsx
// main.tsx
import { createI18n } from '@fukict/i18n';

export const i18n = createI18n({
  defaultLocale: 'en',
  messages,
});

// 提供给所有组件
class I18nProvider extends Fukict {
  mounted() {
    this.provideContext(Symbol('i18n'), i18n);
  }

  render() {
    return this.$slots.default;
  }
}
```

## API 参考

### `createI18n(options)`

创建 i18n 实例。

### I18n 实例方法

| 方法                            | 说明             |
| ------------------------------- | ---------------- |
| `t(key, params?)`               | 翻译文本         |
| `changeLocale(locale)`          | 切换语言         |
| `subscribe(fn)`                 | 订阅语言变化     |
| `n(value, options?)`            | 格式化数字       |
| `d(value, options?)`            | 格式化日期       |
| `rt(value, unit)`               | 格式化相对时间   |
| `addMessages(locale, messages)` | 添加语言包       |
| `getAvailableLocales()`         | 获取可用语言列表 |
