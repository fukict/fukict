<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@vanilla-dom/core Basic Demo</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #4a5568;
        text-align: center;
        margin-bottom: 30px;
      }

      .demo-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        background: #f7fafc;
      }

      .demo-section h3 {
        margin-top: 0;
        color: #2d3748;
      }

      button {
        background: #4299e1;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
        transition: background-color 0.2s;
      }

      button:hover {
        background: #3182ce;
      }

      .counter {
        font-size: 1.2em;
        font-weight: bold;
        color: #2d3748;
      }

      .dynamic-list {
        list-style: none;
        padding: 0;
      }

      .dynamic-list li {
        background: white;
        margin: 5px 0;
        padding: 10px;
        border-radius: 4px;
        border-left: 4px solid #4299e1;
      }

      input {
        padding: 8px 12px;
        border: 1px solid #cbd5e0;
        border-radius: 4px;
        margin: 5px;
      }

      .performance-stats {
        background: #e6fffa;
        border: 1px solid #81e6d9;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
      }

      .api-info {
        background: #fff5f5;
        border: 1px solid #fed7d7;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
      }

      code {
        background: #f7fafc;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        padding: 2px 6px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9em;
        color: #d63384;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ @vanilla-dom/core Basic Demo</h1>
      <p style="text-align: center; color: #718096">
        ç›´æ¥ä½¿ç”¨ ES æ¨¡å—ï¼Œæ— éœ€ç¼–è¯‘çš„é«˜æ€§èƒ½å®¢æˆ·ç«¯æ¸²æŸ“æ¼”ç¤º
      </p>

      <!-- Demo å®¹å™¨ -->
      <div id="demo-root"></div>

      <div class="api-info">
        <h4>ğŸ“š API ä½¿ç”¨è¯´æ˜</h4>
        <p>
          <strong>hyperscript å‡½æ•°ç­¾åï¼š</strong><br />
          <code>hyperscript(type, props, events, ...children)</code><br /><br />
          â€¢ <strong>type</strong>: å…ƒç´ ç±»å‹æˆ–ç»„ä»¶å‡½æ•°<br />
          â€¢ <strong>props</strong>: å±æ€§å¯¹è±¡ï¼ˆå¦‚ className, id ç­‰ï¼‰<br />
          â€¢ <strong>events</strong>: äº‹ä»¶å¯¹è±¡ï¼ˆå¦‚ { click: handler }ï¼‰<br />
          â€¢ <strong>children</strong>: å­å…ƒç´ ï¼ˆå¯å˜å‚æ•°ï¼‰
        </p>
      </div>

      <div class="performance-stats">
        <h4>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h4>
        <div id="perf-stats">åŠ è½½ä¸­...</div>
      </div>
    </div>

    <script type="module">
      import { hyperscript, render } from '../../packages/core/dist/index.js';

      // æ€§èƒ½è®¡æ—¶å¼€å§‹
      const startTime = performance.now();

      // åº”ç”¨çŠ¶æ€
      let appState = {
        counter: 0,
        todos: ['å­¦ä¹  Vanilla DOM', 'æ„å»ºé«˜æ€§èƒ½åº”ç”¨'],
        inputValue: '',
      };

      // ç»„ä»¶ï¼šè®¡æ•°å™¨
      function Counter({ count, onIncrement, onDecrement }) {
        return hyperscript(
          'div',
          { class: 'demo-section' },
          null,
          hyperscript('h3', null, null, 'ğŸ”¢ è®¡æ•°å™¨ç»„ä»¶'),
          hyperscript('div', { class: 'counter' }, null, `å½“å‰è®¡æ•°: ${count}`),
          hyperscript(
            'div',
            null,
            null,
            hyperscript('button', null, { click: onDecrement }, 'â– å‡å°‘'),
            hyperscript('button', null, { click: onIncrement }, 'â• å¢åŠ '),
          ),
        );
      }

      // ç»„ä»¶ï¼šTodo åˆ—è¡¨
      function TodoList({ todos, inputValue, onInputChange, onAddTodo }) {
        return hyperscript(
          'div',
          { class: 'demo-section' },
          null,
          hyperscript('h3', null, null, 'ğŸ“ Todo åˆ—è¡¨'),
          hyperscript(
            'div',
            null,
            null,
            hyperscript(
              'input',
              {
                type: 'text',
                placeholder: 'æ·»åŠ æ–°ä»»åŠ¡...',
                value: inputValue,
              },
              {
                input: e => onInputChange(e.target.value),
              },
            ),
            hyperscript('button', null, { click: onAddTodo }, 'æ·»åŠ '),
          ),
          hyperscript(
            'ul',
            { class: 'dynamic-list' },
            null,
            ...todos.map((todo, index) =>
              hyperscript('li', { key: index }, null, `${index + 1}. ${todo}`),
            ),
          ),
        );
      }

      // ç»„ä»¶ï¼šæ€§èƒ½å±•ç¤º
      function PerformanceDemo({ onStressTest }) {
        return hyperscript(
          'div',
          { class: 'demo-section' },
          null,
          hyperscript('h3', null, null, 'âš¡ æ€§èƒ½æµ‹è¯•'),
          hyperscript('p', null, null, 'æµ‹è¯•å¤§é‡ DOM èŠ‚ç‚¹çš„åˆ›å»ºå’Œæ›´æ–°æ€§èƒ½'),
          hyperscript(
            'button',
            null,
            { click: onStressTest },
            'è¿è¡Œå‹åŠ›æµ‹è¯• (1000 èŠ‚ç‚¹)',
          ),
        );
      }

      // ç»„ä»¶ï¼šAPI æ¼”ç¤º
      function APIDemo() {
        return hyperscript(
          'div',
          { class: 'demo-section' },
          null,
          hyperscript('h3', null, null, 'ğŸ”§ API ä½¿ç”¨ç¤ºä¾‹'),
          hyperscript('p', null, null, 'æ­£ç¡®çš„ hyperscript è°ƒç”¨æ–¹å¼ï¼š'),
          hyperscript(
            'div',
            {
              style:
                'background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0;',
            },
            null,
            hyperscript('div', null, null, 'âœ… æœ‰å±æ€§æ— äº‹ä»¶ï¼š'),
            hyperscript(
              'code',
              null,
              null,
              'hyperscript("div", { class: "box" }, null, "å†…å®¹")',
            ),
            hyperscript('br'),
            hyperscript('div', null, null, 'âœ… æ— å±æ€§æœ‰äº‹ä»¶ï¼š'),
            hyperscript(
              'code',
              null,
              null,
              'hyperscript("button", null, { click: handler }, "æŒ‰é’®")',
            ),
            hyperscript('br'),
            hyperscript('div', null, null, 'âœ… æ—¢æœ‰å±æ€§åˆæœ‰äº‹ä»¶ï¼š'),
            hyperscript(
              'code',
              null,
              null,
              'hyperscript("button", { class: "btn" }, { click: handler }, "æŒ‰é’®")',
            ),
          ),
        );
      }

      // ä¸»åº”ç”¨ç»„ä»¶
      function App(state) {
        return hyperscript(
          'div',
          null,
          null,
          // è®¡æ•°å™¨æ¼”ç¤º
          hyperscript(Counter, {
            count: state.counter,
            onIncrement: () => updateState({ counter: state.counter + 1 }),
            onDecrement: () =>
              updateState({ counter: Math.max(0, state.counter - 1) }),
          }),

          // Todo åˆ—è¡¨æ¼”ç¤º
          hyperscript(TodoList, {
            todos: state.todos,
            inputValue: state.inputValue,
            onInputChange: value => updateState({ inputValue: value }),
            onAddTodo: () => {
              if (state.inputValue.trim()) {
                updateState({
                  todos: [...state.todos, state.inputValue.trim()],
                  inputValue: '',
                });
              }
            },
          }),

          // API æ¼”ç¤º
          hyperscript(APIDemo),

          // æ€§èƒ½æµ‹è¯•æ¼”ç¤º
          hyperscript(PerformanceDemo, {
            onStressTest: runStressTest,
          }),
        );
      }

      // çŠ¶æ€æ›´æ–°å‡½æ•°
      function updateState(newState) {
        appState = { ...appState, ...newState };
        renderApp();
      }

      function renderApp() {
        const vnode = hyperscript(App, appState);

        // ç®€å•ç›´æ¥çš„é‡æ–°æ¸²æŸ“ï¼ˆæ¸…ç©ºå®¹å™¨åé‡æ–°æ¸²æŸ“ï¼‰
        const container = document.getElementById('demo-root');
        render(vnode, {
          container: container,
          replace: true, // æ¸…ç©ºå®¹å™¨å†…å®¹
        });
      }

      // å‹åŠ›æµ‹è¯•å‡½æ•°
      function runStressTest() {
        const testStart = performance.now();

        // åˆ›å»º 1000 ä¸ªèŠ‚ç‚¹çš„ VNode æ ‘
        const bigList = Array.from({ length: 1000 }, (_, i) =>
          hyperscript(
            'div',
            {
              key: i,
              style: `padding: 2px; background: hsl(${i % 360}, 50%, 95%)`,
            },
            null,
            `èŠ‚ç‚¹ ${i + 1}`,
          ),
        );

        const stressVNode = hyperscript(
          'div',
          { class: 'demo-section' },
          null,
          hyperscript('h3', null, null, 'ğŸ§ª å‹åŠ›æµ‹è¯•ç»“æœ'),
          hyperscript(
            'div',
            {
              style:
                'max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;',
            },
            null,
            ...bigList,
          ),
        );

        // æ¸²æŸ“åˆ°æ–°å®¹å™¨
        const stressContainer = document.createElement('div');
        document.querySelector('.container').appendChild(stressContainer);

        render(stressVNode, { container: stressContainer });

        const testEnd = performance.now();

        // æ˜¾ç¤ºæ€§èƒ½ç»“æœ
        setTimeout(() => {
          alert(
            `å‹åŠ›æµ‹è¯•å®Œæˆï¼\nåˆ›å»º 1000 ä¸ªèŠ‚ç‚¹è€—æ—¶: ${(testEnd - testStart).toFixed(2)}ms`,
          );

          // 3ç§’åç§»é™¤æµ‹è¯•å®¹å™¨
          setTimeout(() => {
            stressContainer.remove();
          }, 3000);
        }, 100);
      }

      // åˆå§‹æ¸²æŸ“
      renderApp();

      // æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡
      const endTime = performance.now();
      document.getElementById('perf-stats').innerHTML = `
            <div>ğŸš€ åº”ç”¨å¯åŠ¨æ—¶é—´: ${(endTime - startTime).toFixed(2)}ms</div>
            <div>ğŸ“¦ ä½¿ç”¨åŒ…: @vanilla-dom/core v0.1.0</div>
            <div>âš¡ æ¸²æŸ“æ¨¡å¼: å®¢æˆ·ç«¯ç›´æ¥æ¸²æŸ“ (æ— ç¼–è¯‘)</div>
            <div>ğŸ¯ æ›´æ–°ç­–ç•¥: å®Œå…¨é‡æ–°æ¸²æŸ“ (ç®€å•æ¨¡å¼)</div>
            <div>ğŸ”§ æ ¸å¿ƒå‡½æ•°: hyperscript (å‚æ•°: type, props, events, children)</div>
        `;

      // å…¨å±€è°ƒè¯•
      window.vanillaDomDemo = {
        appState,
        updateState,
        renderApp,
        // æš´éœ² API ä¾›æµ‹è¯•
        hyperscript,
        render,
      };

      console.log('ğŸ‰ @vanilla-dom/core demo å·²åŠ è½½å®Œæˆ!');
      console.log('ğŸ“ å¯åœ¨æ§åˆ¶å°é€šè¿‡ window.vanillaDomDemo è®¿é—®åº”ç”¨çŠ¶æ€');
      console.log('ğŸ”§ æ ¸å¿ƒ API: hyperscript(type, props, events, ...children)');
    </script>
  </body>
</html>
